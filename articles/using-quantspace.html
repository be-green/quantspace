<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using quantspace • quantspace</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using quantspace">
<meta property="og:description" content="quantspace">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">quantspace</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/using-quantspace.html">Using quantspace</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="using-quantspace_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using quantspace</h1>
            
      
      
      <div class="hidden name"><code>using-quantspace.Rmd</code></div>

    </div>

    
    
<p>The <code>quantspace</code> library implements a flexible approach to quantile estimation which guarentees that quantiles do not cross at any point in the data. This will walk through the basic usage of quantspace, how to change algorithms, use different standard error methods, handle plotting, prediction, and interpreting coefficients.</p>
<p>To start, we load the library:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://brice.green/quantspace">quantspace</a></span><span class="op">)</span>
<span class="co">#&gt; Loaded quantspace v0.1, using 3 cores for bootstrap sampling (see ?getCores).</span>
<span class="co">#&gt; Bug reports: github.com/be-green/quantspace/issues</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1999</span><span class="op">)</span></code></pre></div>
<p>To get a sense of how quantspace works, I’ll use some simulated data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Design Matrix</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>

<span class="co"># make the scale also depend on X</span>
<span class="va">scale_betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">1.5</span><span class="op">)</span>
<span class="va">err</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">X</span> <span class="op">%*%</span> <span class="va">scale_betas</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">%*%</span> <span class="va">betas</span> <span class="op">+</span> <span class="va">err</span></code></pre></div>
<p>This gives us some fatter tails and some dependence in the tails. Let’s look at y in order to get a sense.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="co"># what does the tail dependence do relative to normal errors</span>
<span class="va">y_no_err_dep</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">%*%</span> <span class="va">betas</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span><span class="op">(</span><span class="va">y_no_err_dep</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Y with normal errors"</span><span class="op">)</span></code></pre></div>
<p><img src="using-quantspace_files/figure-html/plot_data-1.png" width="624"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Y with tail dependence"</span><span class="op">)</span>
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="using-quantspace_files/figure-html/unnamed-chunk-3-1.png" width="624"></p>
<div id="the-qs-function" class="section level1">
<h1 class="hasAnchor">
<a href="#the-qs-function" class="anchor"></a>The <code>qs</code> function</h1>
<div id="basic-use" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-use" class="anchor"></a>Basic use</h2>
<p>Let’s try to get at that info! The main function which estimates models via quantile spacings is the <code>qs</code> function. Let’s check out an example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regression_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, <span class="va">X</span><span class="op">)</span>

<span class="co"># fits a quantile spacings model</span>
<span class="co"># these quantiles are set as the default argument, and you</span>
<span class="co"># can change them as you need to</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qs.html">qs</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">regression_data</span>, 
          quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>,<span class="fl">0.9</span><span class="op">)</span>, 
          baseline_quantile <span class="op">=</span> <span class="fl">0.5</span>,
          algorithm <span class="op">=</span> <span class="st">"sfn"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="co">#&gt; Baseline Quantile Coefficients:</span>
<span class="co">#&gt;       Variable Quantile Coefficient       SE</span>
<span class="co">#&gt; 1 (Intercept)      0.5     0.01095 0.020610</span>
<span class="co">#&gt; 2          X1      0.5    -0.99270 0.007648</span>
<span class="co">#&gt; 3          X2      0.5     2.00300 0.012160 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Quantile Spacing Coefficients:</span>
<span class="co">#&gt;        Variable Quantile Coefficient Standard.Error</span>
<span class="co">#&gt; 1  (Intercept)     0.10     -0.5139        0.03463</span>
<span class="co">#&gt; 2           X1     0.10      0.2680        0.03253</span>
<span class="co">#&gt; 3           X2     0.10      1.4440        0.03262</span>
<span class="co">#&gt; 4  (Intercept)     0.25     -0.4443        0.02520</span>
<span class="co">#&gt; 5           X1     0.25      0.2794        0.02471</span>
<span class="co">#&gt; 6           X2     0.25      1.4690        0.02420</span>
<span class="co">#&gt; 7  (Intercept)     0.75     -0.4065        0.02210</span>
<span class="co">#&gt; 8           X1     0.75      0.2393        0.02253</span>
<span class="co">#&gt; 9           X2     0.75      1.5080        0.02521</span>
<span class="co">#&gt; 10 (Intercept)     0.90     -0.4618        0.02932</span>
<span class="co">#&gt; 11          X1     0.90      0.2455        0.03139</span>
<span class="co">#&gt; 12          X2     0.90      1.4790        0.03674 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Quantile Psuedo-R2:</span>
<span class="co">#&gt;     0.1: 0.4459</span>
<span class="co">#&gt;     0.25:    0.4446</span>
<span class="co">#&gt;     0.5: 0.2872</span>
<span class="co">#&gt;     0.75:    0.4661</span>
<span class="co">#&gt;     0.9: 0.45</span></code></pre></div>
<p>We’ve already made a couple choices here. First, we set the regression formula, second we specified the data. The ones that are a bit stranger are the <code>quantiles</code> and <code>baseline_quantile</code> arguments. Because the quantile spacings model is a <em>joint</em> model, we need to estimate everything recursively.</p>
<p>To get the 0.25 spacing coefficient, we take the predicted median value, <span class="math inline">\(\hat{y}_{med}\)</span>, and calculate <span class="math inline">\(r = y - \hat{y}_{med}\)</span>. For the positive residuals, we then take <code><a href="https://rdrr.io/r/base/Log.html">log(r)</a></code> as the outcome variable, and estimate a median regression. For negative residuals, we do the same thing but with <code><a href="https://rdrr.io/r/base/Log.html">log(-r)</a></code>. This guarentees that the quantiles fitted by the model don’t ever cross.</p>
<p>The <code>baseline_quantile</code> is the quantile that we take spacings relative to. We don’t recommend changing this away from the median, which is the default. The <code>quantiles</code> argument is simply the complete list of quantile effects you want to estimate.</p>
<p>The <code>algorithm</code> argument is the algorithm you want to use in order to fit the quantile regression at each stage. This will be covered in more detail later, but the options include all the algorithms implemented in the <code>quantreg</code> package (e.g. “br”, “pfn”, “sfn”) as well as “agd”, which implements accelerated gradient descent over a semi-smooth approximation of the quantile loss function, and “lasso” and “post-lasso”, which are penalized variants of the other algorithms. There will be more to come in the future, and there is an interface for adding your own algorithm which will be documented in a separate vignette. By default, this is “sfn”, which is the fastest method available in the <code>quantreg</code> package for most problems. For large-scale problems, you may see speed gains from using the “agd” algorithm.</p>
<p><em>Note (June 7, 2021): the interface to the penalized regression variants is likely to change in the near future. Treat as experimental.</em></p>
<p>There are also <code>s3</code> methods common to other packages available for basic operations. These include <code>coef</code> and <code>coefficients</code>, which return a matrix of coefficients, <code>predict</code> which returns fitted quantiles (or out of sample predictions via the argument <code>newdata</code>), <code>summary</code> which summarizes the fitted model, and <code>resid</code> and <code>residuals</code> which return model residuals.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get coefficients</span>
<span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="co"># get residuals</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="co"># in sample predictions</span>
<span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="co"># out of sample predictions</span>
<span class="va">oos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">pred_oos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">oos</span><span class="op">)</span></code></pre></div>
<p>The <code>qs</code> function also has some control parameters you can see described in more detail on the help page for the function (<code><a href="../reference/qs.html">?qs</a></code>), including <code>parallel</code>, which determines whether bootstrap draws should be parallelized, <code>calc_se</code> which determines whether to calculate standard errors, and <code>weights</code>, which allows you run a weighted regression.</p>
</div>
<div id="advanced-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-usage" class="anchor"></a>Advanced Usage</h2>
<p>The more sophisticated controls for the quantile spacings model and standard errors are specified via the <code>control</code> and <code>std_err_control</code> arguments. Each of these is specified via calls to the <code><a href="../reference/qs_control.html">qs_control()</a></code> and <code><a href="../reference/se_control.html">se_control()</a></code> functions. For details, you can always check the help pages (e.g. <code><a href="../reference/qs_control.html">?qs_control</a></code>).</p>
<p>The <code>qs_control</code> function allows you to set <code>small</code>, the level at which values are treated as zero, <code>trunc</code>, whether to truncate residuals below the value of <code>small</code>, <code>lambda</code>, an optional penalty parameter for use with the <code>lasso</code> algorithm, <code>output_quantiles</code>, which controls whether to save fitted quantiles, and <code>calc_avg_me</code>, which determines whether to calculate average marginal effects. Perhaps with the exception of <code>lambda</code>, none of these need to be changed very often (if at all).</p>
<p>The <code>se_control</code> function allows the user to specify various aspects of the bootstrapping and subsampling used to calculate standard errors. By default, standard errors are calculated via subsampling, with 100 draws. There are several available algorithms for computing standard errors, all based on empirical reweighting and bootstrapping. Setting <code>se_control(se_method = "weighted_bootstrap"</code>) will randomly re-weight data based on random exponential weights drawn with rate parameter 1. Using <code>"subsample"</code>, which is the default, will construct subsamples of the data (without replacement. The size of these subsamples is set via <code>subsample_percent</code>. Using <code>"bootstrap"</code> will use data sample with replacement the same size as the original sample. To truly customize this, you can set this argument to <code>"rq_sample"</code>.</p>
<p>The other <code>se_control</code> parameters allow you to customize the subsampling percent, the number of bootstraps (<code>num_bs</code>), whether to use random exponential weights (<code>draw_weights</code>), whether to sample with or without replacement or to leave the sample alone (<code>sampling_method</code>), and the size of the data at which point the bootstrapping/subsamplign will be done in parallel (<code>parallel_thresh</code>).</p>
<p>In the future, the package may add closed-form standard errors via the delta method, but as of now all standard error methods are based on bootstrapping and subsampling.</p>
</div>
</div>
<div id="distributional-modeling" class="section level1">
<h1 class="hasAnchor">
<a href="#distributional-modeling" class="anchor"></a>Distributional Modeling</h1>
<p>The other thing that the <code>quantspace</code> package is very useful for is modeling the full distribution of outcomes. To do this, it contains routines which efficiently interpolate the fitted quantiles via cubic splines. Modeling the log distance away from the median, rather than treating each quantile independently, prevents the fitted quantiles from crossing, which means that we can always recover a valid density by interpolating between them.</p>
<p>Right now this is done with cubic splines, which can (very occasionally) go negative, which would not imply a valid CDF. If that happens, it’s probably a sign that this is a very poor model for your problem or that you have data which is quite small.</p>
<p>So how do we do this? Let’s take our fit from above and interpolate it. Because our model is non-linear, the distance between quantiles will vary with the data. By default, the <code>distributional_effects</code> function performs this interpolation at the average level of the data, returning the pdf, cdf, quantile function, and a random number generator for the fitted density.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distributional_effects.html">distributional_effects</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co"># evaluate the density at 0</span>
  pdf <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="fu">pdf</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,
  <span class="co"># evaluate the cdf at 0</span>
  cdf <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, 
  <span class="co"># return the fitted median</span>
  quantile <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="fu">q</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, 
  <span class="co"># generate 10 random numbers from fitted density</span>
  <span class="va">d</span><span class="op">$</span><span class="fu">r</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; $pdf</span>
<span class="co">#&gt; [1] 0.1398311</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $cdf</span>
<span class="co">#&gt; [1] 0.49907</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $quantile</span>
<span class="co">#&gt; [1] 0.006652383</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt;  [1] -0.01780072  1.89721126  1.44911488 -2.33121367 -3.96389870 -3.56534170</span>
<span class="co">#&gt;  [7] -4.16744913 -5.33487463  1.78081162 -3.02092618</span></code></pre></div>
<p>We can also do this for various levels of the data. Let’s see how these change as we move up in the first dimension of our X variable.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">X_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,
                       X1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, 
                       X2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="co"># interpolate fitted quantiles at all levels of X1</span>
<span class="va">vary_x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distributional_effects.html">distributional_effects</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">X_levels</span>, tails <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vary_x2</span>, tail_level <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></code></pre></div>
<p><img src="using-quantspace_files/figure-html/plot_de-1.png" width="624"></p>
</div>
<div id="marginal-effects" class="section level1">
<h1 class="hasAnchor">
<a href="#marginal-effects" class="anchor"></a>Marginal Effects</h1>
<p>The marginal effects functionality in the <code>quantspace</code> package is baked into the function <code>marginal_effects</code>. This can be used to compute average marginal effects, marginal effects at the average, or marginal effects across different levels of a variable (holding the other variables constant at the sample average).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># average marginal effects</span>
<span class="fu"><a href="../reference/marginal_effects.html">marginal_effects</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"ame"</span><span class="op">)</span>
<span class="co">#&gt; Average Marginal Effects </span>
<span class="co">#&gt; X1: </span>
<span class="co">#&gt;        0.1      0.25        0.5       0.75      0.9</span>
<span class="co">#&gt;  -1.249838 -1.242354 -0.9927048 -0.2009702 4.652145</span>
<span class="co">#&gt; X2: </span>
<span class="co">#&gt;        0.1      0.25      0.5     0.75      0.9</span>
<span class="co">#&gt;  0.6500988 0.6904133 2.003003 6.991483 36.22921</span></code></pre></div>
<p>This computes marginal effects at the sample average.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># marginal effects at the average</span>
<span class="fu"><a href="../reference/marginal_effects.html">marginal_effects</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"mea"</span><span class="op">)</span>
<span class="co">#&gt; Marginal Effects at the Average </span>
<span class="co">#&gt; X1: </span>
<span class="co">#&gt;        0.1      0.25        0.5       0.75        0.9</span>
<span class="co">#&gt;  -1.333568 -1.172606 -0.9927048 -0.8327413 -0.6774448</span>
<span class="co">#&gt; X2: </span>
<span class="co">#&gt;       0.1     0.25      0.5     0.75      0.9</span>
<span class="co">#&gt;  0.190075 1.057131 2.003003 3.010885 3.946473</span></code></pre></div>
<p>This computes marginal effects across different levels of each variable, holding all others in the model fixed.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># marginal effects for varying levels of each variable</span>
<span class="fu"><a href="../reference/marginal_effects.html">marginal_effects</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"varying"</span><span class="op">)</span>
<span class="co">#&gt; Varying Over Levels </span>
<span class="co">#&gt; X1: </span>
<span class="co">#&gt;           X1       0.1       0.25        0.5       0.75         0.9</span>
<span class="co">#&gt;  -2.26103948 -1.005308 -0.9991773 -0.9927048 -0.9874306 -0.98196734</span>
<span class="co">#&gt;  -1.93044557 -1.013104 -1.0032235 -0.9927048 -0.9840232 -0.97511530</span>
<span class="co">#&gt;  -1.59985165 -1.025723 -1.0097991 -0.9927048 -0.9784145 -0.96389004</span>
<span class="co">#&gt;  -1.26925774 -1.046150 -1.0204852 -0.9927048 -0.9691824 -0.94549999</span>
<span class="co">#&gt;  -0.93866382 -1.079215 -1.0378515 -0.9927048 -0.9539860 -0.91537137</span>
<span class="co">#&gt;  -0.60806990 -1.132738 -1.0660740 -0.9927048 -0.9289720 -0.86601022</span>
<span class="co">#&gt;  -0.27747599 -1.219379 -1.1119392 -0.9927048 -0.8877978 -0.78513768</span>
<span class="co">#&gt;   0.05311793 -1.359634 -1.1864760 -0.9927048 -0.8200235 -0.65263439</span>
<span class="co">#&gt;   0.38371185 -1.586681 -1.3076079 -0.9927048 -0.7084640 -0.43553333</span>
<span class="co">#&gt;   0.71430576 -1.954237 -1.5044629 -0.9927048 -0.5248324 -0.07981439</span>
<span class="co">#&gt;   1.04489968 -2.549265 -1.8243776 -0.9927048 -0.2225670  0.50304230</span>
<span class="co">#&gt;   1.37549360 -3.512559 -2.3442802 -0.9927048  0.2749748  1.45809273</span>
<span class="co">#&gt;   1.70608751 -5.072068 -3.1891888 -0.9927048  1.0939497  3.02304309</span>
<span class="co">#&gt;   2.03668143 -7.596852 -4.5622741 -0.9927048  2.4420171  5.58743592</span>
<span class="co">#&gt; X2: </span>
<span class="co">#&gt;           X2         0.1        0.25      0.5      0.75       0.9</span>
<span class="co">#&gt;  -2.28629570   1.9382666   1.9701582 2.003003  2.035037  2.066789</span>
<span class="co">#&gt;  -1.95661863   1.8983672   1.9496978 2.003003  2.055660  2.107362</span>
<span class="co">#&gt;  -1.62694157   1.8338733   1.9164918 2.003003  2.089559  2.173745</span>
<span class="co">#&gt;  -1.29726450   1.7296228   1.8626004 2.003003  2.145281  2.282363</span>
<span class="co">#&gt;  -0.96758743   1.5611053   1.7751379 2.003003  2.236874  2.460086</span>
<span class="co">#&gt;  -0.63791037   1.2886979   1.6331912 2.003003  2.387434  2.750891</span>
<span class="co">#&gt;  -0.30823330   0.8483451   1.4028201 2.003003  2.634918  3.226738</span>
<span class="co">#&gt;   0.02144376   0.1364929   1.0289412 2.003003  3.041726  4.005390</span>
<span class="co">#&gt;   0.35112083  -1.0142714   0.4221575 2.003003  3.710423  5.279565</span>
<span class="co">#&gt;   0.68079789  -2.8746032  -0.5626169 2.003003  4.809607  7.364653</span>
<span class="co">#&gt;   1.01047496  -5.8820771  -2.1608484 2.003003  6.616412 10.776812</span>
<span class="co">#&gt;   1.34015202 -10.7441420  -4.7546848 2.003003  9.586382 16.360791</span>
<span class="co">#&gt;   1.66982909 -18.6045859  -8.9643299 2.003003 14.468326 25.499146</span>
<span class="co">#&gt;   1.99950615 -31.3126920 -15.7963382 2.003003 22.493113 40.454678</span></code></pre></div>
<p>You can also specify a single variable of interest like so.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># marginal effects at the average, just X2</span>
<span class="fu"><a href="../reference/marginal_effects.html">marginal_effects</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"mea"</span>, variable <span class="op">=</span> <span class="st">"X2"</span><span class="op">)</span>
<span class="co">#&gt; Marginal Effects at the Average </span>
<span class="co">#&gt; X2: </span>
<span class="co">#&gt;       0.1     0.25      0.5     0.75      0.9</span>
<span class="co">#&gt;  0.190075 1.057131 2.003003 3.010885 3.946473</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brice Green.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
